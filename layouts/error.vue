<script setup lang="ts">
import { storeToRefs } from 'pinia'
import type { Settings } from '~/lib/apiSettings'
import { useSiteStore } from '~/stores/site'

const { data: context } = await useFetch('/api/config')

const { locale: i18nLocale } = useI18n()
const { settings, locale } = storeToRefs(useSiteStore())
const { apiEndpoint } = useApiEndpoint()
const { data, error, status } = await useAsyncData('parallel', async () => $fetch<Settings>(`${apiEndpoint.value}/${context.value?.project}/${context.value?.theme}/settings.json`))

if (error.value)
  throw createError(error.value)

if (status.value === 'success' && data.value) {
  settings.value = Object.assign(
    {
      id: 0,
      slug: '',
      name: '',
      attribution: [],
      icon_font_css_url: '',
      bbox_line: {
        type: 'LineString',
        coordinates: [
          [1.43862, 42.41845],
          [1.68279, 42.6775],
        ],
      },
      themes: {},
    },
    data.value,
  )
  locale.value = i18nLocale.value
}
</script>

<template>
  <div class="v-locale--is-ltr">
    <slot />
  </div>
</template>
